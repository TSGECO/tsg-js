<!DOCTYPE html>
<html</div>>
<head>
  <meta charset="UTF-8">
  <title>TSG Core JS Demo</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    .result {
      margin: 10px 0;
      padding: 10px;
      background-color: #f0f0f0;
      border-radius: 4px;
    }
    .section {
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid #ddd;
    }
    button {
      background-color: #4CAF50;
      border: none;
      color: white;
      padding: 8px 16px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 14px;
      margin: 4px 2px;
      cursor: pointer;
      border-radius: 4px;
    }
    input {
      padding: 8px;
      margin: 4px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    textarea {
      width: 100%;
      height: 150px;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <h1>TSG Core JS Demo</h1>

  <div class="section">
    <h2>Basic Functions</h2>
    <button id="greet-btn">Run Greet()</button>
    <div class="result" id="greet-result">Greet result will appear here</div>
    
    <h3>Add Function</h3>
    <input type="number" id="num1" placeholder="Number 1" value="5">
    <input type="number" id="num2" placeholder="Number 2" value="10">
    <button id="add-btn">Add Numbers</button>
    <div class="result" id="add-result">Addition result will appear here</div>
  </div>

  <div class="section">
    <h2>Graph Functions</h2>
    <p>Enter a TSG graph JSON below:</p>
    <textarea id="graph-json">{
  "graphs": {
    "test_graph": {
      "nodes": [
        {"id": "node1", "data": {"label": "Node 1"}},
        {"id": "node2", "data": {"label": "Node 2"}}
      ],
      "edges": [
        {"id": "edge1", "source": "node1", "target": "node2"}
      ]
    }
  }
}</textarea>
    <button id="save-graph-btn">Save Graph to File</button>
    <button id="load-graph-btn">Test Load Graph</button>
    <div class="result" id="graph-result">Graph operation result will appear here</div>
  </div>

  <script type="module">
    // Updated script to properly load the WASM module
    import init, { greet, add, load_graph } from './pkg/tsg_core_js.js';

    // Function to initialize the WebAssembly module
    async function initWasm() {
      try {
        // Initialize the module without manually fetching the wasm
        await init();
        
        console.log("WebAssembly module loaded successfully!");
        
        // Now we can use the exported functions
        document.getElementById('greet-btn').addEventListener('click', () => {
          try {
            greet();
            document.getElementById('greet-result').textContent = "Greet function called! (Check for alert)";
          } catch (e) {
            document.getElementById('greet-result').textContent = `Error: ${e.message}`;
            console.error("Error in greet function:", e);
          }
        });
        
        document.getElementById('add-btn').addEventListener('click', () => {
          try {
            const num1 = parseInt(document.getElementById('num1').value || 0);
            const num2 = parseInt(document.getElementById('num2').value || 0);
            const result = add(num1, num2);
            document.getElementById('add-result').textContent = `Result: ${num1} + ${num2} = ${result}`;
          } catch (e) {
            document.getElementById('add-result').textContent = `Error: ${e.message}`;
          }
        });
        
        document.getElementById('save-graph-btn').addEventListener('click', () => {
          try {
            const graphJson = document.getElementById('graph-json').value;
            
            // Create a blob and download link
            const blob = new Blob([graphJson], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'graph.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            document.getElementById('graph-result').textContent = "Graph saved to file!";
          } catch (e) {
            document.getElementById('graph-result').textContent = `Error: ${e.message}`;
          }
        });
        
        document.getElementById('load-graph-btn').addEventListener('click', () => {
          try {
            // This is just a mock since we can't directly load files from the file system
            document.getElementById('graph-result').textContent = 
              "Note: The actual load_graph function requires file system access, which isn't available in the browser. " +
              "In a real-world scenario, you'd need to use a File API to get file content first.";
          } catch (e) {
            document.getElementById('graph-result').textContent = `Error: ${e.message}`;
          }
        });
      } catch (e) {
        console.error("Failed to initialize WebAssembly module:", e);
        document.body.innerHTML = `<h1>Error Loading WebAssembly</h1><p>${e.message}</p>`;
      }
    }
    
    // Initialize when the page loads
    window.addEventListener('load', initWasm);
  </script>
</body>
</html>
